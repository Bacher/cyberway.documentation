
## Назначение смарт-контракта cyber.msig

Системный смарт-контракт `cyber.msig` используется для подписания и отправки в блокчейн транзакций, требующих определенное количество подписей.  

В состав смарт-контракта `cyber.msig` входят операции-действия [propose](#propose), [approve](#approve), [unapprove](#unapprove), [cancel](#cancel), [exec](#exec), [invalidate](#invalidate).

### Используемая терминология

**Предложенная транзакция** — сформированная пользователем транзакция, для выполнения которой требуется получить определенное количество подписей. В состав предложенной транзакции может входить несколько операций, для выполнения которых необходимо задействовать (или уведомить) одного или несколько сторонних пользователей. Транзакция отправляется в блокчейн только после получения не менее «⅔+1» подписей от общего их количества, указанных в данной транзакции.  

**Актор предложенной транзакции** — пользователь, который должен принять непосредственное участие (либо просто быть уведомленным) в выполнении одной или более операций, содержащихся в предложенной транзакции. В качестве актора может быть аккаунт, который должен оплатить ресурсы, необходимые для выполнения одной или более операций.  

**Разрешение на выполнение транзакции** — подпись аккаунта, имеющая вид структуры, содержащей имя аккаунта и требуемый уровень его разрешения.

## propose

Операция-действие `propose` используется для уведомления отдельных пользователей о  создании транзакции для выполнения которой требуется получения от них разрешения.  

```cpp
void multisig::propose(
    ignore<name> proposer,
    ignore<name> proposal_name,
    ignore<std::vector<permission_level>> requested,
    ignore<transaction> trx
 )
```  
**Параметры:**  
  * `proposer` — имя аккаунта, автора предложенной транзакции. 
  * `proposal_name` — уникальное имя, присвоенное предложенной транзакции при ее создании. Данный параметр в совокупности с параметром `proposer` однозначно идентифицируют предложенную транзакцию.   
  * `requested` — список необходимых разрешений, которые требуется получить для выполнения предложенной транзакции.     
  * `trx` — предложенная на выполнение транзакция.  

Для вызова операции-действия `propose` требуется авторизация пользователя `proposer`.  

> **Примечание**  
> По завершении выполнения предложенной транзакции (или в случае ее отмены вызовом `cancel`) присвоенное ей имя может быть использовано вновь для других транзакций. В случае неполучения разрешения на выполнение предложенной транзакции, присвоенное ей имя `proposal_name` не может быть вновь использовано.  

## approve
 
Операция-действие `approve` используется для отправки разрешения от аккаунта, входящего в список [requested](#propose), на выполнение предложенной транзакции.
```cpp
void multisig::approve(
    name proposer,
    name proposal_name,
    permission_level level,
    const eosio::binary_extension<eosio::checksum256>& proposal_hash
)
```  
**Параметры:**  
  * `proposer` — имя аккаунта, автора предложенной на выполнение транзакции.
  * `proposal_name` —  уникальное имя, присвоенное предложенной транзакции при ее создании. Данный параметр в совокупности с параметром `proposer` однозначно идентифицируют предложенную транзакцию.  
  * `level` — разрешение, с помощью которого аккаунт дает свое согласие на выполнение предложенной транзакции. 
  * `proposal_hash` — произвольный параметр, «хэш-сумма» предложенной транзакции. Параметр используется для контроля появления изменений в предложенной транзакции с момента вызова `propose`.  В случае несоответствия «хэш-сумм», указанной `proposal_hash` и полученной для входящей транзакции, разрешение `level` не выдается.  

Для вызова операции-действия `approve` требуется авторизация аккаунта, указанного в параметре `level`.



## unapprove

Операция-действие `unapprove` используется аккаунтом, входящего в список [requested](#propose), для отзыва ранее давшего им разрешения на выполнение предложенной транзакции в случае изменения данным аккаунтом решения.

```cpp
void multisig::unapprove(
    name proposer,
    name proposal_name,
    permission_level level
)
```  
**Параметры:**  
  * `proposer` — имя аккаунта, автора предложенной транзакции.
  * `proposal_name` —  уникальное имя, присвоенное предложенной транзакции при ее создании. Данный параметр в совокупности с параметром `proposer` однозначно идентифицируют предложенную транзакцию.
  * `level` — разрешение, которое отзывается.  

Для вызова операции-действия `unapprove` требуется авторизация аккаунта, указанного в параметре `level`.

## cancel

Операция-действие `cancel` используется для отмены выполнения предложенной транзакции.  

```cpp
void multisig::cancel(
    name proposer,
    name proposal_name,
    name canceler
)
```  
**Параметры:**  
  * `proposer` — имя аккаунта, автора предложенной транзакции.
  * `proposal_name` —  уникальное имя, присвоенное предложенной транзакции при ее создании. Данный параметр в совокупности с параметром `proposer` однозначно идентифицируют предложенную транзакцию.
  * `canceler` — имя аккаунта, актора предложенной транзакции, отменяющего ее выполнение.  

На выполнение предложенной транзакции отводится определенное время. Если по истечении этого времени транзакция не завершается, она может быть отменена любым пользователем, являющимся ее актором. Отменить предложенную транзакцию до истечения отведенного на ее выполнения время может только ее автор, например, после внесения им в нее коррективов. В этом случае параметр `canceler` будет совпадать с параметром `proposer`.  

Для вызова операции-действия `cancel` требуется авторизация аккаунта, указанного в параметре `canceler`.

## exec

Операция-действие `exec` вызывается для выполнения предложенной транзакции.


```cpp
void multisig::exec(
    name proposer,
    name proposal_name,
    name executer
)
```  
**Параметры:**  
  * `proposer` — имя аккаунта, автора предложенной транзакции.
  * `proposal_name` —  уникальное имя, присвоенное предложенной транзакции при ее создании. Данный параметр в совокупности с параметром `proposer` однозначно идентифицируют предложенную транзакцию.
  * `executer` — имя аккаунта, обеспечивающего выполнение предложенной транзакции. В качестве аккаунта `executer` может выступать любой пользователь, который подписывает транзакцию и обеспечивает оплату используемых ресурсов. Транзакция выполняется, если количество разрешений с учетом отозванных составляет не менее «⅔+1» от общего их количества в списке [requested](#propose).  

Для вызова операции-действия `exec` требуется авторизация аккаунта, указанного в параметре `executer`.


## invalidate

Операция-действие `invalidate` используется для аннулирования ранее выданных указанным пользователем разрешений на выполнение предложенных транзакций.    

```cpp
void multisig::invalidate(name account)
```  

Параметр `account` — имя аккаунта из списка [requested](#propose), чьи ранее выданные им разрешения на выполнение предложенных транзакций должны быть признаны недействительными.  

Вызов `invalidate` аннулирует все разрешения, выданные аккаунтом с именем `account`, на выполняемые в настоящий момент предложенные транзакции. Действие `invalidate` не распространяется на разрешения уже завершенных транзакций, а также на разрешения, которые будут выданы данным аккаунтом после вызова `invalidate`.  

Транзакция продолжает выполняться, если количество оставшихся у нее разрешений с учетом аннулированного составляет не менее «⅔+1» от общего их количества в списке [requested](#propose). В противном случае выполнение транзакции прекращается.  

Для вызова операции-действия `invalidate` требуется авторизация аккаунта с именем `account`.

*****  
